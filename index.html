<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ASHARA 1447 ISTIBSAAR</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;800&family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
<style>
  :root{
    --bg:#0f2347;       /* bleu nuit clair */
    --bg-soft:#163060;  /* cartes */
    --fg:#f7fbff;       /* texte principal */
    --muted:#c7d3e6;    /* texte secondaire */
    --accent:#ffd166;   /* or doux */
    --accent-2:#8fd3ff; /* cyan doux */
    --ok:#46d39a;       /* vert succ√®s */
    --ko:#ff6b6b;       /* rouge erreur */
    --border:#2a4a82;   /* bordures */
    --radius:16px;
    --shadow:0 12px 30px rgba(0,0,0,.35);
    --header-h:64px;    /* HAUTEUR HEADER (r√©glable) */
  }

  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--fg);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.6;scroll-behavior:smooth}

  /* Emp√™che le contenu d'√™tre masqu√© par le header fix√© */
  body{padding-top:var(--header-h)}

  a{color:var(--accent);text-decoration:none}
  img{max-width:100%;display:block}

  /* --- CIEL (√©toiles + constellations) --- */
  .sky{position:fixed;inset:0;z-index:-1;background:
    radial-gradient(1200px 600px at 70% -10%, rgba(255,209,102,.12), transparent 60%),
    radial-gradient(900px 500px at 10% 0%, rgba(143,211,255,.12), transparent 55%),
    var(--bg);}
  .stars,.constel{position:absolute;inset:0;pointer-events:none}
  .stars::before,.stars::after{
    content:"";position:absolute;inset:0;background:
      radial-gradient(1px 1px at 10% 20%,#fff,transparent 60%),
      radial-gradient(1.2px 1.2px at 30% 80%,#fff,transparent 60%),
      radial-gradient(1px 1px at 60% 35%,#fff,transparent 60%),
      radial-gradient(1.2px 1.2px at 80% 60%,#fff,transparent 60%),
      radial-gradient(0.8px 0.8px at 45% 55%,#fff,transparent 60%),
      radial-gradient(0.8px 0.8px at 25% 30%,#fff,transparent 60%);
    opacity:.35;animation:twinkle 7s infinite alternate ease-in-out
  }
  .stars::after{filter:blur(1px);opacity:.22;animation-duration:10s}
  @keyframes twinkle{from{opacity:.18}to{opacity:.55}}
  canvas.constel{width:100%;height:100%}

  /* --- HEADER --- */
  header{position:fixed;top:0;left:0;right:0;height:var(--header-h);
    background:rgba(15,35,71,.8);backdrop-filter:blur(8px);
    border-bottom:1px solid var(--border);z-index:50}
  .nav{max-width:1200px;margin:0 auto;padding:10px 18px;display:flex;align-items:center;gap:14px;justify-content:space-between;height:100%}
  .brand{display:flex;align-items:center;gap:12px}
  .mark{width:28px;height:28px;border:2px solid var(--accent);border-radius:50%;position:relative;flex:0 0 auto}
  .mark::after{content:"";position:absolute;inset:6px;border:2px solid var(--accent-2);border-radius:50%;opacity:.7}
  h1{font-family:Orbitron,system-ui,sans-serif;font-size:clamp(1rem,2.4vw,1.35rem);letter-spacing:.5px;color:var(--accent);margin:0}
  nav{display:flex;flex-wrap:wrap;gap:12px}
  nav a{color:var(--fg);font-weight:700}
  nav a:hover{color:var(--accent)}

  /* --- SECTIONS & WRAP --- */
  .wrap{max-width:1200px;margin:0 auto;padding:0 20px}
  section{scroll-margin-top:calc(var(--header-h) + 20px);padding:clamp(40px,7vw,110px) 0}
  .head{text-align:center;max-width:900px;margin:0 auto clamp(24px,4vw,36px)}
  .title{font-family:Orbitron,system-ui,sans-serif;font-weight:800;color:#fff;font-size:clamp(1.6rem,3.8vw,2.4rem);margin:0 0 10px}
  .lead{color:var(--muted);margin:0 auto;max-width:70ch}
  .divider{height:1px;background:linear-gradient(90deg,transparent,#2a4a82,transparent);opacity:.7;margin:clamp(28px,4vw,44px) auto}

  /* --- HERO (texte) --- */
  .hero{text-align:center}
  .hero .cta{display:flex;flex-wrap:wrap;gap:12px;justify-content:center;margin-top:16px}
  .btn{padding:12px 18px;border-radius:12px;border:1px solid var(--border);background:rgba(22,48,96,.6);color:var(--fg);font-weight:700}
  .btn--accent{background:var(--accent);border-color:#d9b24a;color:#1a1300}
  .btn:hover{filter:brightness(1.06)}

  /* --- SESSIONS --- */
  .card{background:linear-gradient(180deg, rgba(255,255,255,.03), transparent), var(--bg-soft);
    border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:22px}
  .card p{margin:.2rem 0}
  .center{display:flex;justify-content:center;align-items:center;gap:12px;flex-wrap:wrap;margin-top:14px}

  /* --- LISTE VAHEZ --- */
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:clamp(14px,2.4vw,22px)}
  .vahez{display:flex;flex-direction:column;gap:6px;padding:18px;border-radius:14px;background:
     linear-gradient(180deg, rgba(255,255,255,.02), transparent), var(--bg-soft);border:1px solid var(--border);
     box-shadow:0 10px 26px rgba(0,0,0,.3);transition:transform .25s ease, box-shadow .25s ease, border-color .2s}
  .vahez:hover{transform:translateY(-6px);box-shadow:0 18px 36px rgba(0,0,0,.4);border-color:var(--accent)}
  .vahez h3{margin:0;font-size:1.05rem;font-weight:800;letter-spacing:.2px}
  .vahez p{margin:0;color:var(--muted);font-size:.95rem}
  .vahez a{margin-top:8px;align-self:flex-start}

  /* --- QUIZ --- */
  .quiz{max-width:900px;margin:0 auto}
  .qbox{background:linear-gradient(180deg, rgba(255,255,255,.03), transparent), var(--bg-soft);
    border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:22px}
  .prog{height:10px;background:#10264d;border:1px solid var(--border);border-radius:999px;overflow:hidden;margin:0 0 14px}
  .bar{height:100%;width:0;background:linear-gradient(90deg,#38d39f,#ffd166)}
  .qmeta{display:flex;justify-content:space-between;gap:12px;color:var(--accent);font-weight:700;margin-bottom:6px}
  .question{font-weight:700;font-size:clamp(1rem,2.8vw,1.2rem);margin:6px 0 12px}
  .choices{display:grid;gap:10px}
  .choice{background:#1b3a6d;border:1px solid var(--border);padding:12px;border-radius:12px;cursor:pointer;transition:transform .15s ease, border-color .2s}
  .choice:hover{border-color:var(--accent);transform:translateY(-2px)}
  .choice.selected{outline:2px solid var(--accent);outline-offset:2px}
  .choice.correct{background:rgba(70,211,154,.9);color:#0b241a;border-color:#2aa474}
  .choice.wrong{background:rgba(255,107,107,.9);color:#260b0b;border-color:#d94e4e}
  .exp{color:var(--muted);font-size:.95rem;min-height:1.35em;margin-top:8px}
  .controls{display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;margin-top:12px}
  .pill{padding:10px 14px;border-radius:12px;border:1px solid var(--border);background:rgba(22,48,96,.6);color:var(--fg);font-weight:800;cursor:pointer}
  .pill--accent{background:var(--accent);border-color:#d9b24a;color:#1a1300}
  .pill[disabled]{opacity:.6;cursor:not-allowed}
  .final{margin-top:14px;text-align:center;font-weight:800}

  /* --- RESP --- */
  @media (max-width:560px){
    :root{ --header-h:70px; }
    .qmeta{flex-direction:column;gap:6px}
    nav{gap:10px}
  }
</style>
</head>
<body>
<div class="sky">
  <div class="stars"></div>
  <canvas class="constel" id="constel" aria-hidden="true"></canvas>
</div>

<header>
  <div class="nav wrap">
    <div class="brand">
      <div class="mark" aria-hidden="true"></div>
      <h1>ASHARA 1447 ISTIBSAAR</h1>
    </div>
    <nav>
      <a href="#sessions">Sessions</a>
      <a href="#vahez">Vahez</a>
      <a href="#quiz">Quiz</a>
    </nav>
  </div>
</header>

<main>

  <!-- HERO -->
  <section class="hero wrap" id="hero">
    <div class="head">
      <h2 class="title">R√©flexions ‚Äî Guidance cosmique & spirituelle</h2>
      <p class="lead">Parcours les Vahez (2·µâ ‚Üí 10·µâ Muharram), rejoins les sessions d‚ÄôIstibsaar francophones et mesure tes connaissances gr√¢ce √† un quiz interactif.</p>
      <div class="cta">
        <a class="btn btn--accent" href="#vahez">Voir les Vahez</a>
        <a class="btn" href="#sessions">S‚Äôinscrire aux sessions</a>
        <a class="btn" href="#quiz">Faire le quiz</a>
      </div>
    </div>
  </section>

  <div class="divider wrap"></div>

  <!-- SESSIONS -->
  <section class="wrap" id="sessions">
    <div class="head">
      <h3 class="title">Ashara Mubaraka 1447H ‚Äî Sessions Istibsaar üá´üá∑</h3>
      <p class="lead">Aa saal, Ashara Mubaraka 1447H ma, Aqa Maula TUS ye je aflaak ane taarao ni zikr farmaawi ehna si Francophone Mumineen barakat haasil kare te vaaste Huzurala TUS ye karam ane ehsaan farmavi ne makhsoos istibsaar na online sessions ni Raza Mubarak fadal farmaavi che.</p>
    </div>
    <div class="card">
      <p>Pour participer, merci de compl√©ter le formulaire ci-dessous :</p>
      <div class="center">
        <a class="btn btn--accent" href="https://forms.gle/nVk7VtF99cjg6hbQ6" target="_blank" rel="noopener">Formulaire d‚Äôinscription</a>
      </div>
      <p class="lead" style="text-align:center;margin-top:10px;">√Ä remplir <strong>avant le dimanche 10 ao√ªt</strong>.</p>
    </div>
  </section>

  <div class="divider wrap"></div>

  <!-- VAHEZ -->
  <section class="wrap" id="vahez">
    <div class="head">
      <h3 class="title">Les Vahez (2·µâ ‚Üí 10·µâ Muharram)</h3>
      <p class="lead">Clique sur une carte pour ouvrir le PDF correspondant. (Pas d‚Äôaper√ßu, juste le document complet.)</p>
    </div>

    <div class="grid">
      <div class="vahez">
        <h3>Al-Falak al-Muheet</h3>
        <p>Orbite enveloppante ‚Äî sph√®re la plus ext√©rieure qui embrasse l‚Äôunivers.</p>
        <a href="2nd Muharram al Haraam (1).pdf" target="_blank" rel="noopener">Ouvrir le PDF</a>
      </div>

      <div class="vahez">
        <h3>Falak al-Buruj</h3>
        <p>Sph√®re des √©toiles fixes & constellations, demeures des ¬´ buruj ¬ª.</p>
        <a href="3rd Muharram al Haraam.pdf" target="_blank" rel="noopener">Ouvrir le PDF</a>
      </div>

      <div class="vahez">
        <h3>Zohal (Saturne)</h3>
        <p>Discipline & endurance ‚Äî ma√Ætre de l‚Äôeffort et des √©preuves.</p>
        <a href="4th Muharram al Haram.pdf" target="_blank" rel="noopener">Ouvrir le PDF</a>
      </div>

      <div class="vahez">
        <h3>Mushtari (Jupiter)</h3>
        <p>Prosp√©rit√© & noblesse ‚Äî la ¬´ bonne fortune ¬ª s‚Äôacquiert par l‚Äôeffort.</p>
        <a href="5th Muharram al Haram.pdf" target="_blank" rel="noopener">Ouvrir le PDF</a>
      </div>

      <div class="vahez">
        <h3>Mirrikh (Mars)</h3>
        <p>Force, courage & r√©silience ‚Äî protection et fermet√©.</p>
        <a href="6th Muharram al Haram.pdf" target="_blank" rel="noopener">Ouvrir le PDF</a>
      </div>

      <div class="vahez">
        <h3>Zuhra (V√©nus)</h3>
        <p>Harmonie, beaut√© & gr√¢ce ‚Äî √©quilibre du c≈ìur.</p>
        <a href="7th Muharram al Haram.pdf" target="_blank" rel="noopener">Ouvrir le PDF</a>
      </div>

      <div class="vahez">
        <h3> øUtarid (Mercure)</h3>
        <p>Vivacit√© & clart√© ‚Äî liaison entre savoir et action.</p>
        <a href="8th Muharram al Haram.pdf" target="_blank" rel="noopener">Ouvrir le PDF</a>
      </div>

      <div class="vahez">
        <h3>Shams (Soleil)</h3>
        <p>Lumi√®re & guidance ‚Äî source de chaleur et de vie.</p>
        <a href="9eme Muharram al Haram.pdf" target="_blank" rel="noopener">Ouvrir le PDF</a>
      </div>

      <div class="vahez">
        <h3>Qamar (Lune)</h3>
        <p>R√©ceptivit√© & cycles ‚Äî miroir de la lumi√®re solaire.</p>
        <a href="10eme Muharram al Haram.pdf" target="_blank" rel="noopener">Ouvrir le PDF</a>
      </div>
    </div>
  </section>

  <div class="divider wrap"></div>

  <!-- QUIZ -->
  <section class="wrap" id="quiz">
    <div class="head">
      <h3 class="title">Quiz interactif ‚Äî 20 questions</h3>
      <p class="lead">Une question √† la fois, feedback imm√©diat, progression visible. Rejoue autant que tu veux.</p>
    </div>

    <div class="quiz">
      <div class="qbox" id="qbox" aria-live="polite">
        <div class="prog" aria-hidden="true"><div class="bar" id="bar"></div></div>
        <div class="qmeta">
          <div id="qIndex">Question 1 / 20</div>
          <div id="qScore" aria-live="polite">Score : 0</div>
        </div>
        <div class="question" id="qTitle">‚Ä¶</div>
        <div class="choices" id="qChoices"></div>
        <div class="exp" id="qExp" aria-live="polite"></div>
        <div class="controls">
          <button class="pill" id="prevBtn" disabled>‚Üê Pr√©c√©dent</button>
          <div style="display:flex;gap:10px">
            <button class="pill" id="checkBtn" disabled>Valider</button>
            <button class="pill pill--accent" id="nextBtn" disabled>Suivant ‚Üí</button>
          </div>
          <button class="pill" id="resetBtn">Rejouer</button>
        </div>
        <div class="final" id="finalResult" aria-live="polite"></div>
      </div>
    </div>
  </section>

  <div class="divider wrap"></div>
</main>

<script>
/* ---------- CONSTELLATIONS ANIM√âES ---------- */
const canvas = document.getElementById('constel');
const ctx = canvas.getContext('2d');
function sizeCanvas(){canvas.width=innerWidth;canvas.height=innerHeight}
sizeCanvas(); addEventListener('resize', sizeCanvas, {passive:true});

const N=90;
const stars = Array.from({length:N},()=>({
  x: Math.random()*canvas.width,
  y: Math.random()*canvas.height,
  r: Math.random()*1.4+0.3,
  vx: (Math.random()-.5)*0.2,
  vy: (Math.random()-.5)*0.2
}));
const mouse={x:-9999,y:-9999};
addEventListener('mousemove', e=>{mouse.x=e.clientX;mouse.y=e.clientY},{passive:true});
addEventListener('mouseleave', ()=>{mouse.x=-9999;mouse.y=-9999},{passive:true});

function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(const s of stars){
    s.x+=s.vx; s.y+=s.vy;
    if(s.x<0||s.x>canvas.width) s.vx*=-1;
    if(s.y<0||s.y>canvas.height) s.vy*=-1;

    ctx.beginPath();
    ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fillStyle='rgba(255,255,255,.8)';
    ctx.fill();
  }
  for(let i=0;i<N;i++){
    for(let j=i+1;j<N;j++){
      const a=stars[i], b=stars[j];
      const d=Math.hypot(a.x-b.x,a.y-b.y);
      const midx=(a.x+b.x)/2, midy=(a.y+b.y)/2;
      const dm=Math.hypot(midx-mouse.x, midy-mouse.y);
      const nearMouse = dm<220 ? (1 - dm/220) : 0;
      if(d<120){
        ctx.strokeStyle=`rgba(255,255,255,${0.14 + nearMouse*0.25})`;
        ctx.lineWidth= nearMouse ? 1.2 : 0.6;
        ctx.beginPath();
        ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y); ctx.stroke();
      }
    }
  }
  requestAnimationFrame(loop);
}
loop();

/* ---------- QUIZ ---------- */
const questions = [
  {t:"Quelle sph√®re est ¬´ enveloppante ¬ª et la plus ext√©rieure ?", c:["Falak al-Buruj","Al-Falak al-Muheet","Shams"], a:1, e:"Al-Falak al-Muheet est l‚Äôorbite enveloppante et la plus ext√©rieure."},
  {t:"Zohal (Saturne) renvoie surtout √†‚Ä¶", c:["La prosp√©rit√© imm√©diate","La discipline et l‚Äôendurance","La communication"], a:1, e:"Zohal = discipline, endurance, effort."},
  {t:"Mushtari (Jupiter) est associ√© √†‚Ä¶", c:["La bonne fortune acquise par l‚Äôeffort","Les cycles de la lune","L‚Äô√©loquence"], a:0, e:"Mushtari = prosp√©rit√© (sa ø√¢dat) par l‚Äôeffort."},
  {t:"Quelle plan√®te symbolise force et r√©silience ?", c:["Zuhra (V√©nus)","Mirrikh (Mars)"," øUtarid (Mercure)"], a:1, e:"Mirrikh = force, courage, r√©silience."},
  {t:"Falak al-Buruj concerne principalement‚Ä¶", c:["Les constellations et leurs demeures","Les oc√©ans","Les montagnes"], a:0, e:"Sph√®re des √©toiles fixes et constellations (buruj)."},
  {t:"Quel astre est li√© √† l‚Äôharmonie et la gr√¢ce ?", c:["Zuhra (V√©nus)","Shams (Soleil)","Qamar (Lune)"], a:0, e:"Zuhra = harmonie et beaut√©."},
  {t:" øUtarid (Mercure) symbolise surtout‚Ä¶", c:["La clart√© et la vivacit√©","La patience","La rigueur"], a:0, e:"Vivacit√©, clart√©, liaison savoir-action."},
  {t:"Shams (Soleil) renvoie √†‚Ä¶", c:["L‚Äô√©quilibre","La lumi√®re et la guidance","La discr√©tion"], a:1, e:"Shams = lumi√®re et guidance."},
  {t:"Qamar (Lune) est surtout la m√©taphore de‚Ä¶", c:["La chaleur","La r√©ceptivit√© et les cycles","La puissance brute"], a:1, e:"Qamar = r√©ceptivit√© et cycles."},
  {t:"Quel acte prot√®ge avant un voyage ?", c:["Offrir sadaqa","Dormir t√¥t","Manger l√©ger"], a:0, e:"Offrir sadaqa avant (et apr√®s) le voyage."},
  {t:"Le khamr (alcool) est‚Ä¶", c:["Permis en tr√®s petite quantit√©","Haram, m√™me en petite quantit√©","Recommand√© m√©dicalement"], a:1, e:"Le khamr est haram, m√™me en petite quantit√©."},
  {t:"Quelle invocation simple prot√®ge la maison au quotidien ?", c:["Salam","Bismillah","Marhaba"], a:1, e:"Dire Bismillah avant d‚Äôagir."},
  {t:"Le mithaaq cr√©e surtout‚Ä¶", c:["Une obligation fiscale","Une connexion au Wali Allah","Un v≈ìu temporaire"], a:1, e:"Le mithaaq connecte au Wali Allah."},
  {t:"Que signifie ¬´ radd al-shams ¬ª ?", c:["La lune s‚Äôest lev√©e t√¥t","Le soleil a √©t√© ‚Äúramen√©‚Äù pour Asr","Une √©clipse a dur√© trois jours"], a:1, e:"Le soleil fut ‚Äúramen√©‚Äù pour accomplir Asr."},
  {t:"Le Sirat-e-Mustaqeem est d√©crit comme‚Ä¶", c:["Large et facile","Plus fin qu‚Äôun cheveu et plus tranchant qu‚Äôune lame","Un chemin circulaire"], a:1, e:"Plus fin qu‚Äôun cheveu, plus tranchant qu‚Äôune lame."},
  {t:"Science & foi : l‚Äôenseignement est que‚Ä¶", c:["La science contredit la foi","Elles s‚Äôaccordent si bien comprises","La foi doit ignorer la science"], a:1, e:"Elles s‚Äôaccordent quand elles sont bien comprises."},
  {t:"Donner sadaqa √† une personne non-musulmane est‚Ä¶", c:["Non autoris√©","Autoris√©","Obligatoire chaque vendredi"], a:1, e:"Autoris√© : on aide toute personne dans le besoin."},
  {t:"Le walayat du Wali Allah permet surtout‚Ä¶", c:["D‚Äô√©viter toute difficult√©","De traverser l‚Äô√©preuve avec force et s√©r√©nit√©","De ne pas prier"], a:1, e:"Il soutient pour traverser l‚Äô√©preuve avec force et s√©r√©nit√©."},
  {t:"L‚Äô√©thique de travail transmise aux √©tudiants inclut‚Ä¶", c:["Uniquement l‚Äô√©tude th√©orique","Des t√¢ches humbles et formatrices","L‚Äôarr√™t du service"], a:1, e:"Des t√¢ches humbles et formatrices."},
  {t:"Les √©clipses d‚ÄôAshura sont‚Ä¶", c:["Un √©v√©nement banal","Des signes extraordinaires face √† l‚Äôinjustice","Un mythe sans symbolisme"], a:1, e:"Des signes extraordinaires face √† l‚Äôinjustice."}
];

let idx=0, score=0;
const qIndex = document.getElementById('qIndex');
const qScore = document.getElementById('qScore');
const qTitle = document.getElementById('qTitle');
const qChoices = document.getElementById('qChoices');
const qExp = document.getElementById('qExp');
const bar = document.getElementById('bar');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const checkBtn = document.getElementById('checkBtn');
const resetBtn = document.getElementById('resetBtn');
const finalResult = document.getElementById('finalResult');

const picked = new Array(questions.length).fill(null);
const checked = new Array(questions.length).fill(false);
const wasCorrect = new Array(questions.length).fill(false);

function render(){
  const q=questions[idx];
  qIndex.textContent=`Question ${idx+1} / ${questions.length}`;
  qScore.textContent=`Score : ${score}`;
  qTitle.textContent=q.t;
  qChoices.innerHTML=''; qExp.textContent=''; finalResult.textContent='';

  q.c.forEach((label,i)=>{
    const el=document.createElement('button');
    el.type='button';
    el.className='choice';
    el.textContent=label;
    el.setAttribute('aria-pressed', 'false');
    el.addEventListener('click', ()=>{
      picked[idx]=i;
      qChoices.querySelectorAll('.choice').forEach(c=>{
        c.classList.remove('selected','correct','wrong');
        c.setAttribute('aria-pressed','false');
      });
      el.classList.add('selected');
      el.setAttribute('aria-pressed','true');
      checkBtn.disabled=false; 
      nextBtn.disabled=false; // on peut aller au suivant apr√®s s√©lection
    });
    qChoices.appendChild(el);
  });

  if(picked[idx]!==null){
    const node=qChoices.children[picked[idx]];
    if(node) { node.classList.add('selected'); node.setAttribute('aria-pressed','true'); }
    checkBtn.disabled=false;
    if(checked[idx]){ markChoices(); }
    else { nextBtn.disabled=false; }
  }else{
    checkBtn.disabled=true; nextBtn.disabled=true;
  }
  prevBtn.disabled = idx===0;

  const answered = checked.filter(Boolean).length;
  bar.style.width = Math.round(answered/questions.length*100)+'%';
}

function markChoices(){
  const q=questions[idx];
  const choiceNodes=[...qChoices.children];

  choiceNodes.forEach(n=>{ n.style.pointerEvents='none'; n.tabIndex=-1; });

  choiceNodes.forEach((n,i)=>{
    if(i===q.a) n.classList.add('correct');
    if(picked[idx]===i && i!==q.a) n.classList.add('wrong');
  });

  const correctNow = picked[idx]===q.a;
  if(!checked[idx]){ if(correctNow) score++; wasCorrect[idx]=correctNow; checked[idx]=true; }
  qScore.textContent=`Score : ${score}`;
  qExp.innerHTML = (correctNow? "<span style='color:var(--ok);font-weight:800'>‚úî Correct</span> ‚Äî " : "<span style='color:var(--ko);font-weight:800'>‚úò Incorrect</span> ‚Äî ") + q.e;
  nextBtn.disabled = false;
}

prevBtn.addEventListener('click', ()=>{ if(idx>0){ idx--; render(); }});
nextBtn.addEventListener('click', ()=>{
  // Si pas valid√© mais une r√©ponse choisie, on valide automatiquement puis on passe
  if(!checked[idx] && picked[idx]!==null){ 
    markChoices(); 
  }
  if(idx<questions.length-1){ idx++; render(); }
  else{
    finalResult.innerHTML = `R√©sultat final : <strong>${score} / ${questions.length}</strong><br>`+
      (score>16 ? "üåü Excellent ! Tu ma√Ætrises les Vahez." :
       score>12 ? "‚ú® Tr√®s bien ! Encore un petit effort." :
       score>8  ? "üëç Pas mal ‚Äî r√©vise quelques points." :
                   "üìö Continue tes r√©visions, tu y es presque !");
  }
});
checkBtn.addEventListener('click', ()=>{
  if(picked[idx]===null) return;
  markChoices();
});
resetBtn.addEventListener('click', ()=>{
  idx=0; score=0;
  picked.fill(null); checked.fill(false); wasCorrect.fill(false);
  bar.style.width='0%'; finalResult.textContent='';
  // r√©active le pointerEvents
  [...qChoices.children].forEach(n=>{ n.style.pointerEvents='auto'; n.tabIndex=0; });
  render();
});

// Raccourcis clavier
document.addEventListener('keydown', (e)=>{
  if(e.key==='Enter' && !checkBtn.disabled){ e.preventDefault(); checkBtn.click(); }
  if(e.key==='ArrowRight' && !nextBtn.disabled){ e.preventDefault(); nextBtn.click(); }
  if(e.key==='ArrowLeft' && !prevBtn.disabled){ e.preventDefault(); prevBtn.click(); }
},{passive:false});

render();
</script>
</body>
</html>
