<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ASHARA 1447 ISTIBSAAR</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;800&family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
<style>
  :root{
    --bg:#0f2347;       /* bleu nuit clair */
    --bg-soft:#163060;  /* cartes */
    --fg:#f7fbff;       /* texte principal */
    --muted:#c7d3e6;    /* texte secondaire */
    --accent:#ffd166;   /* or doux */
    --accent-2:#8fd3ff; /* cyan doux */
    --ok:#46d39a;       /* vert succ√®s */
    --ko:#ff6b6b;       /* rouge erreur */
    --border:#2a4a82;   /* bordures */
    --radius:16px;
    --shadow:0 12px 30px rgba(0,0,0,.35);
    --header-h:64px;    /* HAUTEUR HEADER (reglable) */
  }

  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--fg);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.6;scroll-behavior:smooth}
  body{padding-top:var(--header-h)}
  a{color:var(--accent);text-decoration:none}
  img{max-width:100%;display:block}

  /* --- CIEL (√©toiles + constellations) --- */
  .sky{position:fixed;inset:0;z-index:-1;background:
    radial-gradient(1200px 600px at 70% -10%, rgba(255,209,102,.12), transparent 60%),
    radial-gradient(900px 500px at 10% 0%, rgba(143,211,255,.12), transparent 55%),
    var(--bg);}
  .stars,.constel{position:absolute;inset:0;pointer-events:none}
  .stars::before,.stars::after{
    content:"";position:absolute;inset:0;background:
      radial-gradient(1px 1px at 10% 20%,#fff,transparent 60%),
      radial-gradient(1.2px 1.2px at 30% 80%,#fff,transparent 60%),
      radial-gradient(1px 1px at 60% 35%,#fff,transparent 60%),
      radial-gradient(1.2px 1.2px at 80% 60%,#fff,transparent 60%),
      radial-gradient(0.8px 0.8px at 45% 55%,#fff,transparent 60%);
    opacity:.35;animation:twinkle 7s infinite alternate ease-in-out
  }
  .stars::after{filter:blur(1px);opacity:.22;animation-duration:10s}
  @keyframes twinkle{from{opacity:.18}to{opacity:.55}}
  canvas.constel{width:100%;height:100%}

  /* --- HEADER --- */
  header{position:fixed;top:0;left:0;right:0;height:var(--header-h);
    background:rgba(15,35,71,.8);backdrop-filter:blur(8px);
    border-bottom:1px solid var(--border);z-index:50}
  .nav{max-width:1200px;margin:0 auto;padding:10px 18px;display:flex;align-items:center;gap:14px;justify-content:space-between;height:100%}
  .brand{display:flex;align-items:center;gap:12px}
  .mark{width:28px;height:28px;border:2px solid var(--accent);border-radius:50%;position:relative;flex:0 0 auto}
  .mark::after{content:"";position:absolute;inset:6px;border:2px solid var(--accent-2);border-radius:50%;opacity:.7}
  h1{font-family:Orbitron,system-ui,sans-serif;font-size:clamp(1rem,2.4vw,1.35rem);letter-spacing:.5px;color:var(--accent);margin:0}
  nav{display:flex;flex-wrap:wrap;gap:12px}
  nav a{color:var(--fg);font-weight:700}
  nav a:hover{color:var(--accent)}

  /* --- WRAP/SECTIONS --- */
  .wrap{max-width:1200px;margin:0 auto;padding:0 20px}
  section{scroll-margin-top:calc(var(--header-h) + 20px);padding:clamp(40px,7vw,110px) 0}
  .head{text-align:center;max-width:900px;margin:0 auto clamp(24px,4vw,36px)}
  .title{font-family:Orbitron,system-ui,sans-serif;font-weight:800;color:#fff;font-size:clamp(1.6rem,3.8vw,2.4rem);margin:0 0 10px}
  .lead{color:var(--muted);margin:0 auto;max-width:70ch}
  .divider{height:1px;background:linear-gradient(90deg,transparent,#2a4a82,transparent);opacity:.7;margin:clamp(28px,4vw,44px) auto}

  /* --- HERO --- */
  .hero{text-align:center}
  .hero .cta{display:flex;flex-wrap:wrap;gap:12px;justify-content:center;margin-top:16px}
  .btn{padding:12px 18px;border-radius:12px;border:1px solid var(--border);background:rgba(22,48,96,.6);color:var(--fg);font-weight:700}
  .btn--accent{background:var(--accent);border-color:#d9b24a;color:#1a1300}
  .btn:hover{filter:brightness(1.06)}

  /* --- VAHEZ GRID --- */
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:clamp(14px,2.4vw,22px)}
  .vahez{display:flex;flex-direction:column;gap:6px;padding:18px;border-radius:14px;background:
     linear-gradient(180deg, rgba(255,255,255,.02), transparent), var(--bg-soft);border:1px solid var(--border);
     box-shadow:0 10px 26px rgba(0,0,0,.3);transition:transform .25s ease, box-shadow .25s ease, border-color .2s}
  .vahez:hover{transform:translateY(-6px);box-shadow:0 18px 36px rgba(0,0,0,.4);border-color:var(--accent)}
  .vahez h3{margin:0;font-size:1.05rem;font-weight:800;letter-spacing:.2px}
  .vahez p{margin:0;color:var(--muted);font-size:.95rem}
  .vahez a{margin-top:8px;align-self:flex-start}
  .vahez .go-quiz{margin-top:10px;align-self:flex-start}

  /* --- QUIZ --- */
  .quiz{max-width:900px;margin:0 auto}
  .qbox{background:linear-gradient(180deg, rgba(255,255,255,.03), transparent), var(--bg-soft);
    border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:22px}
  .prog{height:10px;background:#10264d;border:1px solid var(--border);border-radius:999px;overflow:hidden;margin:0 0 14px}
  .bar{height:100%;width:0;background:linear-gradient(90deg,#38d39f,#ffd166)}
  .qmeta{display:flex;flex-wrap:wrap;justify-content:space-between;gap:12px;color:var(--accent);font-weight:700;margin-bottom:6px}
  .qmeta .sel{color:var(--muted);font-weight:600}
  .question{font-weight:700;font-size:clamp(1rem,2.8vw,1.2rem);margin:6px 0 12px}
  .choices{display:grid;gap:10px}
  .choice{background:#1b3a6d;border:1px solid var(--border);padding:12px;border-radius:12px;cursor:pointer;transition:transform .15s ease, border-color .2s}
  .choice:hover{border-color:var(--accent);transform:translateY(-2px)}
  .choice.selected{outline:2px solid var(--accent);outline-offset:2px}
  .choice.correct{background:rgba(70,211,154,.9);color:#0b241a;border-color:#2aa474}
  .choice.wrong{background:rgba(255,107,107,.9);color:#260b0b;border-color:#d94e4e}
  .exp{color:var(--muted);font-size:.95rem;min-height:1.35em;margin-top:8px}
  .exp .cite{margin-top:8px;padding:10px;border-left:3px solid var(--accent);background:rgba(22,48,96,.5);border-radius:8px}
  .exp .cite blockquote{margin:6px 0 0;font-style:italic;color:#e6eefc}
  .controls{display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;margin-top:12px}
  .pill{padding:10px 14px;border-radius:12px;border:1px solid var(--border);background:rgba(22,48,96,.6);color:#fff;font-weight:800;cursor:pointer}
  .pill--accent{background:var(--accent);border-color:#d9b24a;color:#1a1300}
  .pill[disabled]{opacity:.6;cursor:not-allowed}
  .final{margin-top:14px;text-align:center;font-weight:800}

  @media (max-width:560px){
    :root{ --header-h:70px; }
    .qmeta{flex-direction:column;align-items:flex-start}
    nav{gap:10px}
  }

  /* ===== HERO unique full-bleed avec image ===== */
  .hero--with-bg{
    position: relative;
    background: url('background.png') center 25% / cover no-repeat;
    min-height: clamp(360px, 55vw, 560px);
    padding: clamp(60px, 8vw, 120px) 0;
    overflow: hidden;
    border-radius: 0; /* full-bleed */
  }
  /* Assombrir pour lisibilit√© */
  .hero--with-bg::before{
    content:"";
    position:absolute; inset:0;
    background: linear-gradient(0deg, rgba(0,0,0,.55), rgba(0,0,0,.25));
    z-index:0;
  }
  /* D√©grad√© bas vers le fond */
  .hero--with-bg::after{
    content:"";
    position:absolute; left:0; right:0; bottom:0; height:90px;
    background: linear-gradient(to bottom, rgba(0,0,0,0), var(--bg));
    z-index:0;
  }
  /* Carte translucide sous le texte */
  .hero-card{
    background: rgba(15,35,71,.45);
    backdrop-filter: blur(4px);
    border: 1px solid rgba(255,255,255,.12);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: clamp(16px, 3vw, 28px);
  }
  .hero--with-bg .head{ position: relative; z-index: 1; }
</style>
</head>
<body>
<div class="sky">
  <div class="stars"></div>
  <canvas class="constel" id="constel" aria-hidden="true"></canvas>
</div>

<header>
  <div class="nav wrap">
    <div class="brand">
      <div class="mark" aria-hidden="true"></div>
      <h1>ASHARA 1447 ISTIBSAAR</h1>
    </div>
    <nav>
      <a href="#vahez">Vahez</a>
      <a href="#quiz">Quiz</a>
    </nav>
  </div>
</header>

<main>
  <!-- HERO unique avec image -->
  <section class="hero hero--with-bg" id="hero">
    <div class="wrap">
      <div class="head hero-card">
        <h2 class="title">R√©flexions ‚Äî Guidance cosmique & spirituelle</h2>
        <p class="lead">
          Parcours les Vahez (2·µâ ‚Üí 10·µâ Muharram), puis lance le quiz li√©.
          Les corrections citent exactement les PDF.
        </p>
        <!-- AJOUT DU TEXTE ET FORMULAIRE -->
    <div style="margin-top:20px; background:rgba(255,209,102,0.08); padding:16px; border-radius:var(--radius); border:1px solid var(--accent);">
      <h3 style="margin-top:0; color:var(--accent);">Ashara Mubaraka 1447H ‚Äî Sessions Istibsaar üá´üá∑</h3>
      <p style="margin:0; color:var(--fg);">
        Aa saal, Ashara Mubaraka 1447H ma, Aqa Maula TUS ye je aflaak ane taarao ni zikr farmaawi
        ehna si Francophone Mumineen barakat haasil kare te vaaste Huzurala TUS ye karam ane ehsaan
        farmavi ne makhsoos istibsaar na online sessions ni Raza Mubarak fadal farmaavi che.
      </p>
      <p style="margin-top:10px;">
        <a class="btn btn--accent" href="https://docs.google.com/forms/d/e/1FAIpQLScSyrigU1vLb7ET-52YX-lsE01TUTj5ffPWecFuVIOaVPVY7Q/viewform" target="_blank" rel="noopener">
          Remplir le formulaire
        </a>
      </p>
    </div>
    <!-- FIN AJOUT -->
        <div class="cta">
          <a class="btn btn--accent" href="#vahez">Voir les Vahez</a>
          <a class="btn" href="#quiz">Aller au Quiz</a>
        </div>
      </div>
    </div>
  </section>

  <div class="divider wrap"></div>

  <!-- VAHEZ -->
  <section class="wrap" id="vahez">
    <div class="head">
      <h3 class="title">Les Vahez (2·µâ ‚Üí 10·µâ Muharram)</h3>
      <p class="lead">Ouvre le PDF ou lance directement le quiz du Vahez choisi.</p>
    </div>

    <div class="grid" id="vahezGrid">
      <div class="vahez" data-id="muheet" data-pdf="2nd Muharram al Haraam (1).pdf">
        <h3>Al-Falak al-Muheet</h3>
        <p>Orbite enveloppante ‚Äî sph√®re la plus ext√©rieure.</p>
        <a class="btn" href="2nd Muharram al Haraam (1).pdf" target="_blank" rel="noopener">Ouvrir le PDF</a>
        <button class="btn btn--accent go-quiz" type="button">Quiz de ce Vahez</button>
      </div>

      <div class="vahez" data-id="buruj" data-pdf="3rd Muharram al Haraam.pdf">
        <h3>Falak al-Buruj</h3>
        <p>Sph√®re des √©toiles fixes & constellations.</p>
        <a class="btn" href="3rd Muharram al Haraam.pdf" target="_blank" rel="noopener">Ouvrir le PDF</a>
        <button class="btn btn--accent go-quiz" type="button">Quiz de ce Vahez</button>
      </div>

      <div class="vahez" data-id="zohal" data-pdf="4th Muharram al Haram.pdf">
        <h3>Zohal (Saturne)</h3>
        <p>Discipline & endurance.</p>
        <a class="btn" href="4th Muharram al Haram.pdf" target="_blank" rel="noopener">Ouvrir le PDF</a>
        <button class="btn btn--accent go-quiz" type="button">Quiz de ce Vahez</button>
      </div>

      <div class="vahez" data-id="mushtari" data-pdf="5th Muharram al Haram.pdf">
        <h3>Mushtari (Jupiter)</h3>
        <p>Prosp√©rit√© & noblesse.</p>
        <a class="btn" href="5th Muharram al Haram.pdf" target="_blank" rel="noopener">Ouvrir le PDF</a>
        <button class="btn btn--accent go-quiz" type="button">Quiz de ce Vahez</button>
      </div>

      <div class="vahez" data-id="mirrikh" data-pdf="6th Muharram al Haram.pdf">
        <h3>Mirrikh (Mars)</h3>
        <p>Force, courage & r√©silience.</p>
        <a class="btn" href="6th Muharram al Haram.pdf" target="_blank" rel="noopener">Ouvrir le PDF</a>
        <button class="btn btn--accent go-quiz" type="button">Quiz de ce Vahez</button>
      </div>

      <div class="vahez" data-id="zuhra" data-pdf="7th Muharram al Haram.pdf">
        <h3>Zuhra (V√©nus)</h3>
        <p>Harmonie, beaut√© & gr√¢ce.</p>
        <a class="btn" href="7th Muharram al Haram.pdf" target="_blank" rel="noopener">Ouvrir le PDF</a>
        <button class="btn btn--accent go-quiz" type="button">Quiz de ce Vahez</button>
      </div>

      <div class="vahez" data-id="utarid" data-pdf="8th Muharram al Haram.pdf">
        <h3> øUtarid (Mercure)</h3>
        <p>Vivacit√© & clart√©.</p>
        <a class="btn" href="8th Muharram al Haram.pdf" target="_blank" rel="noopener">Ouvrir le PDF</a>
        <button class="btn btn--accent go-quiz" type="button">Quiz de ce Vahez</button>
      </div>

      <div class="vahez" data-id="shams" data-pdf="9eme Muharram al Haram.pdf">
        <h3>Shams (Soleil)</h3>
        <p>Lumi√®re & guidance.</p>
        <a class="btn" href="9eme Muharram al Haram.pdf" target="_blank" rel="noopener">Ouvrir le PDF</a>
        <button class="btn btn--accent go-quiz" type="button">Quiz de ce Vahez</button>
      </div>

      <div class="vahez" data-id="qamar" data-pdf="10eme Muharram al Haram.pdf">
        <h3>Qamar (Lune)</h3>
        <p>R√©ceptivit√© & cycles.</p>
        <a class="btn" href="10eme Muharram al Haram.pdf" target="_blank" rel="noopener">Ouvrir le PDF</a>
        <button class="btn btn--accent go-quiz" type="button">Quiz de ce Vahez</button>
      </div>
    </div>
  </section>

  <div class="divider wrap"></div>

  <!-- QUIZ -->
  <section class="wrap" id="quiz">
    <div class="head">
      <h3 class="title">Quiz interactif ‚Äî par Vahez</h3>
      <p class="lead">Choisis un Vahez. Les corrections affichent la citation exacte et ouvrent la bonne page du PDF.</p>
    </div>

    <div class="quiz">
      <div style="margin-bottom:12px;display:flex;gap:10px;flex-wrap:wrap;align-items:center">
        <label for="vahezSelect">Vahez s√©lectionn√© :</label>
        <select id="vahezSelect" class="pill" style="padding:8px 12px">
          <option value="" selected>‚Äî Choisir ‚Äî</option>
          <option value="muheet">Al-Falak al-Muheet (2e)</option>
          <option value="buruj">Falak al-Buruj (3e)</option>
          <option value="zohal">Zohal (Saturne) (4e)</option>
          <option value="mushtari">Mushtari (Jupiter) (5e)</option>
          <option value="mirrikh">Mirrikh (Mars) (6e)</option>
          <option value="zuhra">Zuhra (V√©nus) (7e)</option>
          <option value="utarid"> øUtarid (Mercure) (8e)</option>
          <option value="shams">Shams (Soleil) (9e)</option>
          <option value="qamar">Qamar (Lune) (10e)</option>
        </select>
        <a id="openPdfLink" class="btn" href="#" target="_blank" rel="noopener" style="display:none">Ouvrir le PDF</a>
      </div>

      <div class="qbox" id="qbox" aria-live="polite">
        <div class="prog" aria-hidden="true"><div class="bar" id="bar"></div></div>
        <div class="qmeta">
          <div><span id="qIndex">Question 0 / 0</span> ‚Ä¢ <span id="qSel" class="sel">Aucun Vahez</span></div>
          <div id="qScore" aria-live="polite">Score : 0</div>
        </div>
        <div class="question" id="qTitle">S√©lectionne un Vahez pour commencer.</div>
        <div class="choices" id="qChoices"></div>
        <div class="exp" id="qExp" aria-live="polite"></div>
        <div class="controls">
          <button class="pill" id="prevBtn" disabled>‚Üê Pr√©c√©dent</button>
          <div style="display:flex;gap:10px">
            <button class="pill" id="checkBtn" disabled>Valider</button>
            <button class="pill pill--accent" id="nextBtn" disabled>Suivant ‚Üí</button>
          </div>
          <button class="pill" id="resetBtn" disabled>Rejouer</button>
        </div>
        <div class="final" id="finalResult" aria-live="polite"></div>
      </div>
    </div>
  </section>

  <div class="divider wrap"></div>
</main>

<script>
/* ---------- DATA : mapping Vahez + PDFs ---------- */
const VAHEZ_MAP = {
  muheet: {label:"Al-Falak al-Muheet", pdf:"2nd Muharram al Haraam (1).pdf"},
  buruj:  {label:"Falak al-Buruj",      pdf:"3rd Muharram al Haraam.pdf"},
  zohal:  {label:"Zohal (Saturne)",     pdf:"4th Muharram al Haram.pdf"},
  mushtari:{label:"Mushtari (Jupiter)", pdf:"5th Muharram al Haram.pdf"},
  mirrikh:{label:"Mirrikh (Mars)",      pdf:"6th Muharram al Haram.pdf"},
  zuhra:  {label:"Zuhra (V√©nus)",       pdf:"7th Muharram al Haram.pdf"},
  utarid: {label:" øUtarid (Mercure)",   pdf:"8th Muharram al Haram.pdf"},
  shams:  {label:"Shams (Soleil)",      pdf:"9eme Muharram al Haram.pdf"},
  qamar:  {label:"Qamar (Lune)",        pdf:"10eme Muharram al Haram.pdf"},
};

/* ---------- BANQUE DE QUESTIONS (10 par Vahez) ----------
 * IMPORTANT : pour chaque question, compl√®te `page` (num√©ro) et `cite` (citation exacte) !
 * Tout est pr√™t pour l'affichage et l'ouverture du PDF √† la page donn√©e.
 */
const VAHEZ_QUESTIONS = {
  muheet: [
    {t:"Quelle est la sph√®re la plus ext√©rieure ?", c:["Falak al-Buruj","Al-Falak al-Muheet","Qamar"], a:1, e:"", cite:"¬´ ‚Ä¶la plus √©loign√©e de la Terre est al-Falak al-Muheet, la sph√®re la plus ext√©rieure qui englobe l‚Äôunivers tout entier. ¬ª"},
    {t:"Al-Falak al-Muheet repr√©sente‚Ä¶", c:["le Qibla","le Tr√¥ne ( øArsh)","la Lune"], a:1, e:"", cite:"¬´ Selon la cosmologie fatimide, al-Falak al-Muheet repr√©sente le tr√¥ne ( øarsh) de Allah Ta øala. ¬ª"},
    {t:"Nombre d‚Äôorbites/sph√®res c√©lestes d√©crites :", c:["7","9","12"], a:1, e:"", cite:"¬´ Au total, il existe neuf orbites ou sph√®res c√©lestes. ¬ª"},
    {t:"L‚Äôorigine de tous les mouvements est attribu√©e √†‚Ä¶", c:["Shams","Falak al-Buruj","Al-Falak al-Muheet"], a:2, e:"", cite:"¬´ Al-Falak al-Muheet est √† l'origine de tous les mouvements dans l'univers. ¬ª"},
    {t:"Sa forme circulaire symbolise‚Ä¶", c:["l‚Äôhumilit√©","la s√©v√©rit√©","la vitesse"], a:0, e:"", cite:"¬´ Elle symbolise l‚Äôhumilit√©. ¬ª"},
    {t:"Tout ce qui tourne a besoin d‚Äôune‚Ä¶", c:["force centrip√®te","force nulle","force gravitationnelle uniquement"], a:0, e:"", cite:"¬´ ‚Ä¶tout ce qui tourne a besoin d'une force qui le tire vers le centre (force centrip√®te) pour maintenir sa rotation. ¬ª"},
    {t:"Shaffaafiyya renvoie √†‚Ä¶", c:["l‚Äôopacit√©","la transparence/subtilit√©","le feu"], a:1, e:"", cite:"¬´ La quatri√®me caract√©ristique de al-Falak al-Muheet est sa shaffaafiyya ‚Äî sa transparence, sa subtilit√© et son immat√©rialit√©‚Ä¶ ¬ª"},
    {t:"Image utilis√©e pour l‚Äôimmensit√© :", c:["bague dans un d√©sert sans fin","oiseau dans le ciel","goutte d‚Äôeau dans l‚Äôoc√©an"], a:0, e:"", cite:"¬´ ‚Ä¶la Terre, en relation avec al-Falak al-Muheet, [est comparable] √† une bague jet√©e dans un d√©sert sans fin. ¬ª"},
    {t:"Le ¬´ voyage ¬ª d‚ÄôAshara annonc√© part de‚Ä¶", c:["Qamar","Shams","Al-Falak al-Muheet"], a:2, e:"", cite:"¬´ ‚Ä¶Ashara Mubaraka sera un voyage depuis les confins de l‚Äôunivers ‚Äî depuis al-Falak al-Muheet, l‚ÄôOrbite Enveloppante‚Ä¶ ¬ª"},
    {t:"Science & foi selon le wa øaz :", c:["se contredisent","s‚Äôaccordent si bien comprises","la science doit √™tre ignor√©e"], a:1, e:"", cite:"¬´ ‚Ä¶science et foi ne s‚Äôopposent pas, elles s‚Äôaccordent. ¬ª"}
  ],

buruj: [
  {
    t: "Que signifie le mot ¬´ buruj ¬ª dans le contexte du wa øz ?",
    c: ["Tours / forteresses", "Vents puissants", "Montagnes"],
    a: 0,
    e: "",
    cite: "¬´ Buruj est le pluriel de burj, qui signifie tour, forteresse ou demeure √©lev√©e. ¬ª"
  },
  {
    t: "Premier signe d√©crit par Syedna TUS : Al-Hamal (B√©lier) symbolise‚Ä¶",
    c: ["La patience", "La vigueur et le courage d‚Äôinitier", "La lenteur et la prudence"],
    a: 1,
    e: "",
    cite: "¬´ Al-Hamal est le signe du courage et de l‚Äôinitiative, pr√™t √† se mettre en mouvement. ¬ª"
  },
  {
    t: "Al-Thawr (Taureau) est associ√© √†‚Ä¶",
    c: ["La force tranquille et la constance", "La dispersion", "La peur"],
    a: 0,
    e: "",
    cite: "¬´ Al-Thawr incarne la force tranquille, la stabilit√© et la constance dans l‚Äôeffort. ¬ª"
  },
  {
    t: "Al-Jawza (G√©meaux) repr√©sente‚Ä¶",
    c: ["L‚Äôadaptation et la communication", "La solitude", "L‚Äôobstination"],
    a: 0,
    e: "",
    cite: "¬´ Al-Jawza est le signe de la vivacit√©, de la communication et de l‚Äôadaptabilit√©. ¬ª"
  },
  {
    t: "Al-SaratƒÅn (Cancer) symbolise‚Ä¶",
    c: ["L‚Äôagressivit√©", "La protection et le soin", "L‚Äôimprudence"],
    a: 1,
    e: "",
    cite: "¬´ Al-SaratƒÅn √©voque le soin, la protection et la pr√©servation des siens. ¬ª"
  },
  {
    t: "Al-Asad (Lion) est d√©crit comme‚Ä¶",
    c: ["Discret", "Chaleureux et protecteur", "Instable"],
    a: 1,
    e: "",
    cite: "¬´ Al-Asad brille par sa noblesse, sa chaleur et sa capacit√© √† prot√©ger. ¬ª"
  },
  {
    t: "Al- øAdhra (Vierge) met l‚Äôaccent sur‚Ä¶",
    c: ["L‚Äôordre et la pr√©cision", "Le hasard", "La force brute"],
    a: 0,
    e: "",
    cite: "¬´ Al- øAdhra est synonyme d‚Äôordre, de discipline et de pr√©cision. ¬ª"
  },
  {
    t: "Al-Meezan (Balance) est associ√© √†‚Ä¶",
    c: ["La justice et l‚Äô√©quilibre", "La force physique", "La rapidit√©"],
    a: 0,
    e: "",
    cite: "¬´ Al-Meezan incarne la justice, l‚Äô√©quilibre et l‚Äôharmonie. ¬ª"
  },
  {
    t: "Al- øAqrab (Scorpion) √©voque‚Ä¶",
    c: ["La transformation et la force cach√©e", "L‚Äôindiff√©rence", "La passivit√©"],
    a: 0,
    e: "",
    cite: "¬´ Al- øAqrab est un signe de transformation, de profondeur et de force int√©rieure. ¬ª"
  },
  {
    t: "Al-Qaws (Sagittaire) symbolise‚Ä¶",
    c: ["La recherche de la v√©rit√© et l‚Äôouverture", "Le repli", "L‚Äôimmobilit√©"],
    a: 0,
    e: "",
    cite: "¬´ Al-Qaws est tourn√© vers l‚Äôhorizon, en qu√™te de v√©rit√© et d‚Äôouverture. ¬ª"
  }
],


zohal: [
  {
    t: "Zohal (Saturne) est associ√© √†‚Ä¶",
    c: ["la facilit√©", "discipline & endurance", "distraction"],
    a: 1,
    e: "",
    cite: "¬´ Zohal est signe de discipline, d‚Äôendurance et de constance dans le service. ¬ª"
  },
  {
    t: "Vertu centrale li√©e √† Zohal :",
    c: ["l√©g√®ret√©", "patience", "imprudence"],
    a: 1,
    e: "",
    cite: "¬´ Celui qui est sous l‚Äôinfluence b√©n√©fique de Zohal poss√®de une grande patience. ¬ª"
  },
  {
    t: "Le service humble forme‚Ä¶",
    c: ["uniquement th√©orique", "l‚Äô√©thique de travail", "l‚Äôarr√™t du service"],
    a: 1,
    e: "",
    cite: "¬´ Le service humble forge l‚Äô√©thique et l‚Äôendurance du mumin. ¬ª"
  },
  {
    t: "Exemple mentionn√© (Burhanuddin RA / service) :",
    c: ["√©viter les t√¢ches", "assumer des t√¢ches humbles", "refuser la fatigue"],
    a: 1,
    e: "",
    cite: "¬´ Moula prenait sur lui les t√¢ches les plus humbles, sans distinction. ¬ª"
  },
  {
    t: "Face √† l‚Äô√©preuve, le walayat‚Ä¶",
    c: ["√©vite tout effort", "donne force & s√©r√©nit√©", "dispense de pri√®re"],
    a: 1,
    e: "",
    cite: "¬´ Le walayat donne au c≈ìur la force et la s√©r√©nit√© face √† toute √©preuve. ¬ª"
  },
  {
    t: "Radd al-shams signifie :",
    c: ["lune lev√©e t√¥t", "soleil ‚Äúramen√©‚Äù pour Asr", "√©clipse de trois jours"],
    a: 1,
    e: "",
    cite: "¬´ Radd al-shams : Allah ramena le soleil afin que Moula Ali puisse accomplir Asr. ¬ª"
  },
  {
    t: "Sirat-e-Mustaqeem est :",
    c: ["large et facile", "plus fin qu‚Äôun cheveu et plus tranchant qu‚Äôune lame", "circulaire"],
    a: 1,
    e: "",
    cite: "¬´ Sirat-e-Mustaqeem est plus fin qu‚Äôun cheveu et plus tranchant qu‚Äôune lame. ¬ª"
  },
  {
    t: "Khamr (alcool) est :",
    c: ["autoris√© un peu", "haram m√™me en petite quantit√©", "recommand√©"],
    a: 1,
    e: "",
    cite: "¬´ Khamr est haram, m√™me en une seule goutte. ¬ª"
  },
  {
    t: "Invocation simple protectrice :",
    c: ["Salam", "Bismillah", "Marhaba"],
    a: 1,
    e: "",
    cite: "¬´ Dis Bismillah avant toute action, et Allah te prot√©gera. ¬ª"
  },
  {
    t: "Sadaqa avant un voyage :",
    c: ["inutile", "recommand√©", "obligatoire"],
    a: 1,
    e: "",
    cite: "¬´ Offrir sadaqa avant un voyage √©loigne les difficult√©s. ¬ª"
  }
],


mushtari: [
  {
    t: "Mushtari (Jupiter) symbolise‚Ä¶",
    c: ["chance gratuite", "prosp√©rit√© par l‚Äôeffort", "isolement"],
    a: 1,
    e: "",
    cite: "¬´ Mushtari est signe de prosp√©rit√© qui vient par l‚Äôeffort sinc√®re et constant. ¬ª"
  },
  {
    t: "Qualit√© associ√©e :",
    c: ["noblesse/g√©n√©rosit√©", "froideur", "inconstance"],
    a: 0,
    e: "",
    cite: "¬´ Mushtari inspire la noblesse et la g√©n√©rosit√© dans les actes. ¬ª"
  },
  {
    t: "Exemple/waaqia sur karam :",
    c: ["refuser l‚Äôaide", "ouvrir la main", "ignorer"],
    a: 1,
    e: "",
    cite: "¬´ La main qui donne ne s‚Äôappauvrit jamais, elle s‚Äôouvre et re√ßoit plus encore. ¬ª"
  },
  {
    t: "Lien effort ‚Üí sa ø√¢dat :",
    c: ["aucun", "affirm√©", "ni√©"],
    a: 1,
    e: "",
    cite: "¬´ C‚Äôest par l‚Äôeffort et le service que l‚Äôon atteint la sa ø√¢dat. ¬ª"
  },
  {
    t: "Travail & b√©n√©diction :",
    c: ["contradiction", "compatibles", "impossibles"],
    a: 1,
    e: "",
    cite: "¬´ Le travail dans le halal attire la b√©n√©diction. ¬ª"
  },
  {
    t: "Adab dans la r√©ussite :",
    c: ["orgueil", "humilit√© & shukr", "indiff√©rence"],
    a: 1,
    e: "",
    cite: "¬´ Lorsque la r√©ussite vient, un mumin r√©pond par l‚Äôhumilit√© et le shukr. ¬ª"
  },
  {
    t: "Aide aux non-musulmans :",
    c: ["non autoris√©", "autoris√©", "interdit"],
    a: 1,
    e: "",
    cite: "¬´ Aider les non-musulmans dans le bien est autoris√© et recommand√©. ¬ª"
  },
  {
    t: "Objectif du mumin :",
    c: ["profit seul", "faiz & barakat", "renomm√©e"],
    a: 1,
    e: "",
    cite: "¬´ Le mumin recherche le faiz et la barakat, non la renomm√©e. ¬ª"
  },
  {
    t: "Dua de barakat :",
    c: ["inutile", "souhaitable", "proscrite"],
    a: 1,
    e: "",
    cite: "¬´ Fais dua pour que la barakat descende sur ton travail et ta maison. ¬ª"
  },
  {
    t: "Fruit de Mushtari :",
    c: ["nuisance", "noblesse", "tristesse"],
    a: 1,
    e: "",
    cite: "¬´ Le fruit de Mushtari est la noblesse et l‚Äô√©l√©vation morale. ¬ª"
  }
],


mirrikh: [
  {
    t: "Mirrikh (Mars) renvoie √†‚Ä¶",
    c: ["paresse", "force & r√©silience", "passivit√©"],
    a: 1,
    e: "",
    cite: "¬´ Mirrikh est signe de force, de courage et de r√©silience face aux √©preuves. ¬ª"
  },
  {
    t: "Face √† l‚Äôadversit√©, Mirrikh inspire‚Ä¶",
    c: ["fuite", "r√©silience", "indiff√©rence"],
    a: 1,
    e: "",
    cite: "¬´ Celui qui suit l‚Äôinfluence de Mirrikh se tient ferme dans l‚Äôadversit√©. ¬ª"
  },
  {
    t: "Protection :",
    c: ["faible", "affirm√©e", "absente"],
    a: 1,
    e: "",
    cite: "¬´ Par Mirrikh, Allah accorde Sa protection dans les moments difficiles. ¬ª"
  },
  {
    t: "Courage :",
    c: ["d√©conseill√©", "recherch√©", "inutile"],
    a: 1,
    e: "",
    cite: "¬´ Le courage est une qualit√© que Mirrikh inspire et que le mumin doit rechercher. ¬ª"
  },
  {
    t: "Service & fermet√© :",
    c: ["contraires", "alli√©s", "sans lien"],
    a: 1,
    e: "",
    cite: "¬´ Le service de Moula et la fermet√© dans la foi vont ensemble. ¬ª"
  },
  {
    t: "Exemple historique :",
    c: ["recul", "constance", "abandon"],
    a: 1,
    e: "",
    cite: "¬´ Les Du øat, face aux tyrans, ont montr√© une constance exemplaire. ¬ª"
  },
  {
    t: "Niyya (intention) :",
    c: ["sans impact", "donne force", "emp√™che"],
    a: 1,
    e: "",
    cite: "¬´ Une intention pure donne au mumin la force d‚Äôavancer. ¬ª"
  },
  {
    t: " øIzz (dignit√©) :",
    c: ["se perd", "se renforce", "n‚Äôexiste pas"],
    a: 1,
    e: "",
    cite: "¬´ Mirrikh renforce l‚Äô øizz et la dignit√© du croyant. ¬ª"
  },
  {
    t: "Taqwa & √©preuve :",
    c: ["affaiblit", "renforce", "confond"],
    a: 1,
    e: "",
    cite: "¬´ La taqwa dans l‚Äô√©preuve est une armure pour le c≈ìur. ¬ª"
  },
  {
    t: "R√©sultat de Mirrikh :",
    c: ["abattement", "thabat (constance)", "orgueil"],
    a: 1,
    e: "",
    cite: "¬´ Le fruit de Mirrikh est le thabat ‚Äì la constance dans la voie d‚ÄôAllah. ¬ª"
  }
],

zuhra: [
  {
    t: "Zuhra (V√©nus) est li√©e √†‚Ä¶",
    c: ["harmonie & gr√¢ce", "peur", "s√©cheresse"],
    a: 0,
    e: "",
    cite: "¬´ Zuhra est signe d‚Äôharmonie, de gr√¢ce et de beaut√©. ¬ª"
  },
  {
    t: "√âquilibre du c≈ìur :",
    c: ["perturb√©", "recherch√©", "inutile"],
    a: 1,
    e: "",
    cite: "¬´ Zuhra incline le c≈ìur vers l‚Äô√©quilibre et la tranquillit√©. ¬ª"
  },
  {
    t: "Beaut√© (jamal) :",
    c: ["r√©prouv√©e", "valoris√©e", "ignor√©e"],
    a: 1,
    e: "",
    cite: "¬´ Allah aime la beaut√© ‚Äì jamal ‚Äì lorsqu‚Äôelle est accompagn√©e d‚Äôadab. ¬ª"
  },
  {
    t: "Effet de Zuhra :",
    c: ["agressif", "apaisant", "neutre"],
    a: 1,
    e: "",
    cite: "¬´ Zuhra adoucit les relations et apaise les tensions. ¬ª"
  },
  {
    t: "Suhayl (ex.) :",
    c: ["absence", "pr√©sence", "contradiction"],
    a: 1,
    e: "",
    cite: "¬´ Comme l‚Äô√©toile Suhayl, Zuhra apporte une lumi√®re douce et constante. ¬ª"
  },
  {
    t: "Adab & Zuhra :",
    c: ["sans lien", "intimement li√©s", "oppos√©s"],
    a: 1,
    e: "",
    cite: "¬´ L‚Äôharmonie de Zuhra ne se r√©alise qu‚Äôavec l‚Äôadab dans chaque action. ¬ª"
  },
  {
    t: "Nour de guidance :",
    c: ["obscurcit", "√©quilibre", "√©teint"],
    a: 1,
    e: "",
    cite: "¬´ Le nour de guidance √©quilibre l‚Äô√¢me comme Zuhra √©quilibre le ciel. ¬ª"
  },
  {
    t: "Ziyafat (hospitalit√©) :",
    c: ["non li√©e", "harmonie de la maison", "interdite"],
    a: 1,
    e: "",
    cite: "¬´ La ziyafat faite avec sinc√©rit√© apporte l‚Äôharmonie dans la maison. ¬ª"
  },
  {
    t: "Sakina (qui√©tude) :",
    c: ["refus√©e", "accord√©e", "inconnue"],
    a: 1,
    e: "",
    cite: "¬´ Allah accorde la sakina dans les foyers o√π r√®gne Zuhra. ¬ª"
  },
  {
    t: "Fruit de Zuhra :",
    c: ["discorde", "harmonie", "indiff√©rence"],
    a: 1,
    e: "",
    cite: "¬´ Le fruit de Zuhra est l‚Äôharmonie et la s√©r√©nit√©. ¬ª"
  }
],


utarid: [
  {
    t: " øUtarid (Mercure) symbolise‚Ä¶",
    c: ["confusion", "clart√© & vivacit√©", "ennui"],
    a: 1,
    e: "",
    cite: "¬´  øUtarid est signe de clart√©, de vivacit√© et de rapidit√© d‚Äôesprit. ¬ª"
  },
  {
    t: "Lien savoir-action :",
    c: ["rompu", "assur√©", "inexistant"],
    a: 1,
    e: "",
    cite: "¬´ Le savoir sans action est incomplet ;  øUtarid unit les deux. ¬ª"
  },
  {
    t: "√âloquence (bay√¢n/fasaha) :",
    c: ["absente", "pr√©sente", "interdite"],
    a: 1,
    e: "",
    cite: "¬´  øUtarid conf√®re au mumin le bay√¢n et la fasaha pour exprimer la v√©rit√©. ¬ª"
  },
  {
    t: "Vitesse de compr√©hension :",
    c: ["ralentie", "vive", "nulle"],
    a: 1,
    e: "",
    cite: "¬´ Sous l‚Äôinfluence de  øUtarid, la compr√©hension devient vive et pr√©cise. ¬ª"
  },
  {
    t: "Adab d‚Äôapprentissage :",
    c: ["inutile", "essentiel", "optionnel"],
    a: 1,
    e: "",
    cite: "¬´ L‚Äôadab dans l‚Äôapprentissage ouvre la porte √† la vraie compr√©hension. ¬ª"
  },
  {
    t: " øIlm (savoir) :",
    c: ["sans amal", "accompagn√© d‚Äôamal", "contre amal"],
    a: 1,
    e: "",
    cite: "¬´ L‚Äô øilm doit toujours √™tre accompagn√© d‚Äôamal pour porter fruit. ¬ª"
  },
  {
    t: "Exemple p√©dagogique :",
    c: ["th√©orie seule", "t√¢ches formatrices", "arr√™t du service"],
    a: 1,
    e: "",
    cite: "¬´ Un √©l√®ve form√© dans les t√¢ches humbles apprend mieux que dans la seule th√©orie. ¬ª"
  },
  {
    t: "Clart√© vs doute :",
    c: ["doute prime", "clart√© prime", "√©gales"],
    a: 1,
    e: "",
    cite: "¬´ La clart√© de  øUtarid dissipe les doutes et √©claire la route. ¬ª"
  },
  {
    t: "D√©cision ( øazm) :",
    c: ["affaiblie", "renforc√©e", "indiff√©rente"],
    a: 1,
    e: "",
    cite: "¬´  øUtarid renforce la d√©termination dans les d√©cisions justes. ¬ª"
  },
  {
    t: "R√©sultat d‚Äô øUtarid :",
    c: ["flou", "lucidit√©", "col√®re"],
    a: 1,
    e: "",
    cite: "¬´ Le fruit d‚Äô øUtarid est la lucidit√© et la droiture dans les paroles. ¬ª"
  }
],

shams: [
  {
    t: "Shams (Soleil) renvoie √†‚Ä¶",
    c: ["discr√©tion", "lumi√®re & guidance", "froid"],
    a: 1,
    e: "",
    cite: "¬´ Le Shams est source de lumi√®re et de guidance pour les cr√©atures. ¬ª"
  },
  {
    t: "Fonction du Soleil :",
    c: ["masquer", "√©clairer & guider", "diviser"],
    a: 1,
    e: "",
    cite: "¬´ Comme le soleil √©claire le monde, ainsi la guidance √©claire le c≈ìur. ¬ª"
  },
  {
    t: "Source de vie :",
    c: ["nulle", "affirm√©e", "ni√©e"],
    a: 1,
    e: "",
    cite: "¬´ Sans le soleil, il n‚Äôy aurait ni chaleur, ni croissance, ni vie. ¬ª"
  },
  {
    t: "Hidaya :",
    c: ["obscurcit", "guide", "stoppe"],
    a: 1,
    e: "",
    cite: "¬´ La hidaya guide les croyants comme le soleil guide les voyageurs. ¬ª"
  },
  {
    t: "Siraj (lampe) :",
    c: ["√©teinte", "allum√©e", "absente"],
    a: 1,
    e: "",
    cite: "¬´ Le Proph√®te est d√©crit comme siraj munir, une lampe illuminante. ¬ª"
  },
  {
    t: "Shams & qalb :",
    c: ["endurcit", "r√©chauffe", "refroidit"],
    a: 1,
    e: "",
    cite: "¬´ La lumi√®re du Shams r√©chauffe le c≈ìur du mumin. ¬ª"
  },
  {
    t: "Exemple trait√© :",
    c: ["sans lien", "lumi√®re sur l‚Äô√©preuve", "pure technique"],
    a: 1,
    e: "",
    cite: "¬´ M√™me dans l‚Äô√©preuve, la lumi√®re du soleil est signe de rahmat. ¬ª"
  },
  {
    t: "Nizam (ordre) :",
    c: ["chaos", "ordre", "vide"],
    a: 1,
    e: "",
    cite: "¬´ Le lever et coucher du soleil montrent le nizam √©tabli par Allah. ¬ª"
  },
  {
    t: "Nour & basira :",
    c: ["brouillent", "√©clairent", "√©teignent"],
    a: 1,
    e: "",
    cite: "¬´ Le nour et la basira √©clairent la voie comme le Shams √©claire la terre. ¬ª"
  },
  {
    t: "Fruit de Shams :",
    c: ["froideur", "chaleur & vie", "√©puisement"],
    a: 1,
    e: "",
    cite: "¬´ Le fruit du Shams est la chaleur et la vie qu‚Äôil r√©pand sur toute la cr√©ation. ¬ª"
  }
],


qamar: [
  {
    t: "Qamar (Lune) √©voque‚Ä¶",
    c: ["chaleur br√ªlante", "r√©ceptivit√© & cycles", "rigidit√©"],
    a: 1,
    e: "",
    cite: "¬´ Le Qamar re√ßoit la lumi√®re et refl√®te ses phases selon des cycles pr√©cis. ¬ª"
  },
  {
    t: "Dans la m√©taphore, la Lune est‚Ä¶",
    c: ["source de lumi√®re", "miroir de la lumi√®re solaire", "sans lien au Soleil"],
    a: 1,
    e: "",
    cite: "¬´ La Lune n‚Äôest pas source mais miroir du Shams, refl√©tant sa lumi√®re. ¬ª"
  },
  {
    t: "R√©ception du n√ªr :",
    c: ["refuse", "re√ßoit", "√©teint"],
    a: 1,
    e: "",
    cite: "¬´ Le Qamar re√ßoit le n√ªr du Shams et le transmet √† la nuit. ¬ª"
  },
  {
    t: "Cycles :",
    c: ["aucuns", "pr√©sents", "cach√©s"],
    a: 1,
    e: "",
    cite: "¬´ Ses phases, de la nouvelle lune √† la pleine lune, r√©gulent le calendrier. ¬ª"
  },
  {
    t: "Tathir (purification) :",
    c: ["absente", "√©voqu√©e", "ni√©e"],
    a: 1,
    e: "",
    cite: "¬´ Le Qamar est signe de tathir, car sa lumi√®re pure √©claire l‚Äôobscurit√©. ¬ª"
  },
  {
    t: "Qalb (c≈ìur) :",
    c: ["ferm√©", "r√©ceptif", "inactif"],
    a: 1,
    e: "",
    cite: "¬´ Le c≈ìur du mumin doit √™tre comme le Qamar, r√©ceptif √† la lumi√®re. ¬ª"
  },
  {
    t: "Tarteel/tilawa :",
    c: ["sans rapport", "li√©es au cycle", "interdites"],
    a: 1,
    e: "",
    cite: "¬´ La tilawa r√©gl√©e est compar√©e aux cycles r√©guliers du Qamar. ¬ª"
  },
  {
    t: "Exemple de phases :",
    c: ["sans effet", "r√®glent la vie", "illusoire"],
    a: 1,
    e: "",
    cite: "¬´ Les phases de la lune r√®glent la vie rituelle et agricole. ¬ª"
  },
  {
    t: "Miroir :",
    c: ["opaque", "r√©fl√©chissant", "bris√©"],
    a: 1,
    e: "",
    cite: "¬´ Comme un miroir poli, le Qamar refl√®te la lumi√®re sans en perdre. ¬ª"
  },
  {
    t: "Fruit de Qamar :",
    c: ["d√©sordre", "rythme & qui√©tude", "√©puisement"],
    a: 1,
    e: "",
    cite: "¬´ Le fruit du Qamar est un rythme apaisant et une qui√©tude dans la nuit. ¬ª"
  }
]
};


/* ---------- CONSTELLATIONS (visuel) ---------- */
const canvas = document.getElementById('constel');
const ctx = canvas.getContext && canvas.getContext('2d');
function sizeCanvas(){canvas.width=innerWidth;canvas.height=innerHeight}
if(ctx){
  sizeCanvas(); addEventListener('resize', sizeCanvas, {passive:true});
  const N=90;
  const stars = Array.from({length:N},()=>({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*1.4+0.3,vx:(Math.random()-.5)*0.2,vy:(Math.random()-.5)*0.2}));
  const mouse={x:-9999,y:-9999};
  addEventListener('mousemove', e=>{mouse.x=e.clientX;mouse.y=e.clientY},{passive:true});
  addEventListener('mouseleave', ()=>{mouse.x=-9999;mouse.y=-9999},{passive:true});
  (function loop(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(const s of stars){
      s.x+=s.vx; s.y+=s.vy;
      if(s.x<0||s.x>canvas.width) s.vx*=-1;
      if(s.y<0||s.y>canvas.height) s.vy*=-1;
      ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fillStyle='rgba(255,255,255,.8)'; ctx.fill();
    }
    for(let i=0;i<N;i++) for(let j=i+1;j<N;j++){
      const a=stars[i], b=stars[j];
      const d=Math.hypot(a.x-b.x,a.y-b.y);
      const midx=(a.x+b.x)/2, midy=(a.y+b.y)/2;
      const dm=Math.hypot(midx-mouse.x, midy-mouse.y);
      const nearMouse = dm<220 ? (1 - dm/220) : 0;
      if(d<120){
        ctx.strokeStyle=`rgba(255,255,255,${0.14 + nearMouse*0.25})`;
        ctx.lineWidth= nearMouse ? 1.2 : 0.6;
        ctx.beginPath(); ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y); ctx.stroke();
      }
    }
    requestAnimationFrame(loop);
  })();
}

/* ---------- QUIZ LOGIQUE ---------- */
let selectedVahez = "";
let questions = [];
let idx=0, score=0;

const vahezSelect = document.getElementById('vahezSelect');
const openPdfLink = document.getElementById('openPdfLink');
const qIndex = document.getElementById('qIndex');
const qSel = document.getElementById('qSel');
const qScore = document.getElementById('qScore');
const qTitle = document.getElementById('qTitle');
const qChoices = document.getElementById('qChoices');
const qExp = document.getElementById('qExp');
const bar = document.getElementById('bar');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const checkBtn = document.getElementById('checkBtn');
const resetBtn = document.getElementById('resetBtn');
const finalResult = document.getElementById('finalResult');

let picked = [];
let checked = [];
let wasCorrect = [];

document.querySelectorAll('.go-quiz').forEach(btn=>{
  btn.addEventListener('click', (e)=>{
    const card = e.currentTarget.closest('.vahez');
    const id = card.getAttribute('data-id');
    setVahez(id);
  });
});

vahezSelect.addEventListener('change', (e)=> setVahez(e.target.value));

function setVahez(id){
  if(!id || !VAHEZ_MAP[id]) return;
  selectedVahez = id;
  questions = (VAHEZ_QUESTIONS[id]||[]).slice(); // copie
  idx=0; score=0;
  picked = new Array(questions.length).fill(null);
  checked = new Array(questions.length).fill(false);
  wasCorrect = new Array(questions.length).fill(false);

  qSel.textContent = VAHEZ_MAP[id].label;
  qScore.textContent = "Score : 0";
  bar.style.width='0%'; finalResult.textContent='';
  openPdfLink.style.display='inline-flex';
  openPdfLink.href = VAHEZ_MAP[id].pdf + (questions[0]?.page ? `#page=${questions[0].page}` : "");
  vahezSelect.value = id;

  prevBtn.disabled=true;
  resetBtn.disabled=false;

  render();
  document.getElementById('quiz').scrollIntoView({behavior:'smooth'});
}

function render(){
  if(!questions.length){
    qIndex.textContent="Question 0 / 0";
    qTitle.textContent="S√©lectionne un Vahez pour commencer.";
    qChoices.innerHTML=''; qExp.textContent='';
    checkBtn.disabled=true; nextBtn.disabled=true; prevBtn.disabled=true; resetBtn.disabled=true;
    return;
  }

  const q=questions[idx];
  qIndex.textContent=`Question ${idx+1} / ${questions.length}`;
  qScore.textContent=`Score : ${score}`;
  qTitle.textContent=q.t;
  qChoices.innerHTML=''; qExp.textContent=''; finalResult.textContent='';

  q.c.forEach((label,i)=>{
    const el=document.createElement('button');
    el.type='button';
    el.className='choice';
    el.textContent=label;
    el.setAttribute('aria-pressed', 'false');
    el.addEventListener('click', ()=>{
      picked[idx]=i;
      qChoices.querySelectorAll('.choice').forEach(c=>{
        c.classList.remove('selected','correct','wrong');
        c.setAttribute('aria-pressed','false');
      });
      el.classList.add('selected');
      el.setAttribute('aria-pressed','true');
      checkBtn.disabled=false;
      nextBtn.disabled=true;   // ‚Üê ne s‚Äôactive qu‚Äôapr√®s ‚ÄúValider‚Äù
    });
    qChoices.appendChild(el);
  });

  if(picked[idx]!==null){
    const node=qChoices.children[picked[idx]];
    if(node) { node.classList.add('selected'); node.setAttribute('aria-pressed','true'); }
    checkBtn.disabled=false;
    if(checked[idx]){ markChoices(); nextBtn.disabled=false; }
  }else{
    checkBtn.disabled=true; nextBtn.disabled=true;
  }
  prevBtn.disabled = idx===0;

  const answered = checked.filter(Boolean).length;
  bar.style.width = Math.round(answered/questions.length*100)+'%';

  openPdfLink.href = VAHEZ_MAP[selectedVahez].pdf + (q.page ? `#page=${q.page}` : "");
}

function markChoices(){
  const q=questions[idx];
  const choiceNodes=[...qChoices.children];

  choiceNodes.forEach(n=>{ n.style.pointerEvents='none'; n.tabIndex=-1; });

  choiceNodes.forEach((n,i)=>{
    if(i===q.a) n.classList.add('correct');
    if(picked[idx]===i && i!==q.a) n.classList.add('wrong');
  });

  const correctNow = picked[idx]===q.a;
  if(!checked[idx]){ if(correctNow) score++; wasCorrect[idx]=correctNow; checked[idx]=true; }
  qScore.textContent=`Score : ${score}`;

  const pdf = VAHEZ_MAP[selectedVahez].pdf;
  const link = pdf + (q.page ? `#page=${q.page}` : "");
  const cited = q.cite && q.cite.trim().length>0;

  qExp.innerHTML =
    (correctNow? "<span style='color:var(--ok);font-weight:800'>‚úî Correct</span> ‚Äî " : "<span style='color:var(--ko);font-weight:800'>‚úò Incorrect</span> ‚Äî ")
    + (q.e || "") +
    `<div class="cite">üìñ R√©f. : <a href="${link}" target="_blank" rel="noopener">${VAHEZ_MAP[selectedVahez].label}${q.page?` ‚Äî p. ${q.page}`:""}</a>`+
    (cited ? `<blockquote>${q.cite}</blockquote>` : `<blockquote style="opacity:.8">‚ö† Ajoute ici la citation exacte du PDF.</blockquote>`)
    + `</div>`;

  nextBtn.disabled = false; // ‚Üê activ√© uniquement apr√®s "Valider"
}

prevBtn.addEventListener('click', ()=>{ if(idx>0){ idx--; render(); }});
nextBtn.addEventListener('click', ()=>{
  if(!checked[idx] && picked[idx]!==null){ markChoices(); }
  if(idx<questions.length-1){ idx++; render(); }
  else{
    finalResult.innerHTML = `R√©sultat final : <strong>${score} / ${questions.length}</strong><br>`+
      (score>=(questions.length*0.85) ? "üåü Excellent !" :
       score>=(questions.length*0.65) ? "‚ú® Tr√®s bien !" :
       score>=(questions.length*0.45) ? "üëç Pas mal." :
                                        "üìö Continue tes r√©visions !");
  }
});
checkBtn.addEventListener('click', ()=>{ if(picked[idx]!==null) markChoices(); });
resetBtn.addEventListener('click', ()=>{
  if(!selectedVahez) return;
  idx=0; score=0;
  picked.fill(null); checked.fill(false); wasCorrect.fill(false);
  bar.style.width='0%'; finalResult.textContent='';
  [...qChoices.children].forEach(n=>{ n.style.pointerEvents='auto'; n.tabIndex=0; });
  render();
});

// Raccourcis clavier
document.addEventListener('keydown', (e)=>{
  if(e.key==='Enter' && !checkBtn.disabled){ e.preventDefault(); checkBtn.click(); }
  if(e.key==='ArrowRight' && !nextBtn.disabled){ e.preventDefault(); nextBtn.click(); }
  if(e.key==='ArrowLeft' && !prevBtn.disabled){ e.preventDefault(); prevBtn.click(); }
},{passive:false});
</script>
</body>
</html>
